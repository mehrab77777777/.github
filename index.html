<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>امپراطوری ایران ۲۰۲۷ - بازی استراتژیک</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="امپراطوری ایران">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="امپراطوری ایران ۲۰۲۷">
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="بازی استراتژیک مدیریت امپراطوری ایران در سال ۲۰۲۷. کشور خود را رهبری کنید!">
    <meta name="keywords" content="بازی فارسی, استراتژی, ایران, امپراطوری, مدیریت">
    <meta name="author" content="Iran Empire Game">
    
    <!-- Open Graph -->
    <meta property="og:title" content="امپراطوری ایران ۲۰۲۷">
    <meta property="og:description" content="بازی استراتژیک مدیریت امپراطوری ایران">
    <meta property="og:image" content="./assets/icons/icon-512x512.png">
    <meta property="og:url" content="./">
    <meta property="og:type" content="website">
    
    <!-- PWA Links -->
    <link rel="manifest" href="./manifest.json">
    <link rel="icon" type="image/png" href="./assets/icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./assets/icons/icon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./assets/icons/icon-32x32.png">
    <link rel="apple-touch-icon" href="./assets/icons/icon-180x180.png">
    <link rel="apple-touch-icon" sizes="152x152" href="./assets/icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./assets/icons/icon-180x180.png">
    <link rel="apple-touch-icon" sizes="167x167" href="./assets/icons/icon-167x167.png">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="game-container">
        <!-- هدر بازی -->
        <header class="game-header">
            <h1>🏛️ امپراطوری ایران ۲۰۲۷</h1>
            <div class="header-stats">
                <div class="stat-item">
                    <span class="stat-label">سال:</span>
                    <span id="current-year">۲۰۲۷</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">نوبت:</span>
                    <span id="current-turn">۱</span>
                </div>
            </div>
        </header>

        <!-- منوی اصلی -->
        <nav class="main-menu">
            <button class="menu-btn active" data-tab="empire">🏰 امپراطوری</button>
            <button class="menu-btn" data-tab="resources">💰 منابع</button>
            <button class="menu-btn" data-tab="military">⚔️ نیروی نظامی</button>
            <button class="menu-btn" data-tab="diplomacy">🤝 دیپلماسی</button>
            <button class="menu-btn" data-tab="research">🔬 تحقیقات</button>
            <button class="menu-btn" data-tab="world">🌍 نقشه جهان</button>
        </nav>

        <!-- صفحه امپراطوری -->
        <div id="empire-tab" class="tab-content active">
            <div class="empire-overview">
                <div class="country-info">
                    <h2>🇮🇷 امپراطوری ایران</h2>
                    <div class="country-stats">
                        <div class="stat-card">
                            <div class="stat-icon">👥</div>
                            <div class="stat-info">
                                <span class="stat-value" id="population">۸۵,۰۰۰,۰۰۰</span>
                                <span class="stat-name">جمعیت</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">🌟</div>
                            <div class="stat-info">
                                <span class="stat-value" id="happiness">۷۵٪</span>
                                <span class="stat-name">رضایتمندی</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">🏭</div>
                            <div class="stat-info">
                                <span class="stat-value" id="industry">۶۵٪</span>
                                <span class="stat-name">صنعت</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">🎯</div>
                            <div class="stat-info">
                                <span class="stat-value" id="stability">۸۰٪</span>
                                <span class="stat-name">ثبات</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="regions-section">
                    <h3>🗺️ استان‌های امپراطوری</h3>
                    <div class="regions-grid" id="regions-list">
                        <!-- این قسمت با JavaScript پر می‌شود -->
                    </div>
                </div>
            </div>
        </div>

        <!-- صفحه منابع -->
        <div id="resources-tab" class="tab-content">
            <div class="resources-overview">
                <h2>💰 مدیریت منابع</h2>
                <div class="resources-grid">
                    <div class="resource-card">
                        <div class="resource-icon">💰</div>
                        <div class="resource-info">
                            <span class="resource-amount" id="gold">۱۰۰,۰۰۰</span>
                            <span class="resource-name">طلا</span>
                            <span class="resource-income">+۱۵,۰۰۰ در نوبت</span>
                        </div>
                    </div>
                    <div class="resource-card">
                        <div class="resource-icon">🌾</div>
                        <div class="resource-info">
                            <span class="resource-amount" id="food">۸۰,۰۰۰</span>
                            <span class="resource-name">غذا</span>
                            <span class="resource-income">+۱۲,۰۰۰ در نوبت</span>
                        </div>
                    </div>
                    <div class="resource-card">
                        <div class="resource-icon">⚡</div>
                        <div class="resource-info">
                            <span class="resource-amount" id="energy">۶۰,۰۰۰</span>
                            <span class="resource-name">انرژی</span>
                            <span class="resource-income">+۸,۰۰۰ در نوبت</span>
                        </div>
                    </div>
                    <div class="resource-card">
                        <div class="resource-icon">🏭</div>
                        <div class="resource-info">
                            <span class="resource-amount" id="production">۴۵,۰۰۰</span>
                            <span class="resource-name">تولید</span>
                            <span class="resource-income">+۶,۰۰۰ در نوبت</span>
                        </div>
                    </div>
                </div>

                <div class="economic-actions">
                    <h3>🏗️ پروژه‌های اقتصادی</h3>
                    <div class="projects-grid">
                        <div class="project-card">
                            <h4>🏦 ساخت بانک مرکزی</h4>
                            <p>درآمد طلا +۲۰٪</p>
                            <div class="project-cost">هزینه: ۲۰,۰۰۰ طلا</div>
                            <button class="project-btn" onclick="buildProject('bank')">ساخت</button>
                        </div>
                        <div class="project-card">
                            <h4>🚜 توسعه کشاورزی</h4>
                            <p>تولید غذا +۳۰٪</p>
                            <div class="project-cost">هزینه: ۱۵,۰۰۰ طلا</div>
                            <button class="project-btn" onclick="buildProject('farm')">ساخت</button>
                        </div>
                        <div class="project-card">
                            <h4>⚡ نیروگاه برق</h4>
                            <p>تولید انرژی +۲۵٪</p>
                            <div class="project-cost">هزینه: ۲۵,۰۰۰ طلا</div>
                            <button class="project-btn" onclick="buildProject('powerplant')">ساخت</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- صفحه نیروی نظامی -->
        <div id="military-tab" class="tab-content">
            <div class="military-overview">
                <h2>⚔️ نیروی نظامی</h2>
                <div class="military-stats">
                    <div class="military-card">
                        <div class="military-icon">🪖</div>
                        <div class="military-info">
                            <span class="military-amount" id="infantry">۵۰,۰۰۰</span>
                            <span class="military-name">پیاده نظام</span>
                        </div>
                    </div>
                    <div class="military-card">
                        <div class="military-icon">🚁</div>
                        <div class="military-info">
                            <span class="military-amount" id="air-force">۲۵۰</span>
                            <span class="military-name">نیروی هوایی</span>
                        </div>
                    </div>
                    <div class="military-card">
                        <div class="military-icon">🚢</div>
                        <div class="military-info">
                            <span class="military-amount" id="navy">۱۵۰</span>
                            <span class="military-name">نیروی دریایی</span>
                        </div>
                    </div>
                    <div class="military-card">
                        <div class="military-icon">🚀</div>
                        <div class="military-info">
                            <span class="military-amount" id="missiles">۱۰۰</span>
                            <span class="military-name">موشک‌ها</span>
                        </div>
                    </div>
                </div>

                <div class="recruitment-section">
                    <h3>🎖️ استخدام نیرو</h3>
                    <div class="recruitment-grid">
                        <div class="recruitment-card">
                            <h4>🪖 آموزش سرباز</h4>
                            <p>+۱,۰۰۰ پیاده نظام</p>
                            <div class="recruitment-cost">هزینه: ۵,۰۰۰ طلا</div>
                            <button class="recruitment-btn" onclick="recruitUnit('infantry')">استخدام</button>
                        </div>
                        <div class="recruitment-card">
                            <h4>✈️ ساخت جنگنده</h4>
                            <p>+۱۰ جنگنده</p>
                            <div class="recruitment-cost">هزینه: ۲۰,۰۰۰ طلا</div>
                            <button class="recruitment-btn" onclick="recruitUnit('airforce')">ساخت</button>
                        </div>
                        <div class="recruitment-card">
                            <h4>🚢 ساخت ناوشکن</h4>
                            <p>+۵ ناوشکن</p>
                            <div class="recruitment-cost">هزینه: ۳۰,۰۰۰ طلا</div>
                            <button class="recruitment-btn" onclick="recruitUnit('navy')">ساخت</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- صفحه دیپلماسی -->
        <div id="diplomacy-tab" class="tab-content">
            <div class="diplomacy-overview">
                <h2>🤝 روابط دیپلماتیک</h2>
                <div class="countries-list">
                    <div class="country-relation">
                        <div class="country-flag">🇺🇸</div>
                        <div class="country-name">ایالات متحده</div>
                        <div class="relation-status neutral">بی‌طرف</div>
                        <div class="diplomacy-actions">
                            <button onclick="changeDiplomacy('usa', 'alliance')">اتحاد</button>
                            <button onclick="changeDiplomacy('usa', 'trade')">تجارت</button>
                            <button onclick="changeDiplomacy('usa', 'hostility')">خصومت</button>
                        </div>
                    </div>
                    <div class="country-relation">
                        <div class="country-flag">🇷🇺</div>
                        <div class="country-name">روسیه</div>
                        <div class="relation-status friendly">دوستانه</div>
                        <div class="diplomacy-actions">
                            <button onclick="changeDiplomacy('russia', 'alliance')">اتحاد</button>
                            <button onclick="changeDiplomacy('russia', 'trade')">تجارت</button>
                            <button onclick="changeDiplomacy('russia', 'hostility')">خصومت</button>
                        </div>
                    </div>
                    <div class="country-relation">
                        <div class="country-flag">🇨🇳</div>
                        <div class="country-name">چین</div>
                        <div class="relation-status friendly">دوستانه</div>
                        <div class="diplomacy-actions">
                            <button onclick="changeDiplomacy('china', 'alliance')">اتحاد</button>
                            <button onclick="changeDiplomacy('china', 'trade')">تجارت</button>
                            <button onclick="changeDiplomacy('china', 'hostility')">خصومت</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- صفحه تحقیقات -->
        <div id="research-tab" class="tab-content">
            <div class="research-overview">
                <h2>🔬 تحقیقات و فناوری</h2>
                <div class="research-points">
                    <div class="research-stat">
                        <span class="research-icon">🧪</span>
                        <span>امتیاز تحقیق: <span id="research-points">۲۵,۰۰۰</span></span>
                    </div>
                </div>
                <div class="research-tree">
                    <div class="research-category">
                        <h3>🏭 فناوری صنعتی</h3>
                        <div class="research-item">
                            <h4>🤖 اتوماسیون صنعتی</h4>
                            <p>تولید +۲۰٪</p>
                            <div class="research-cost">هزینه: ۱۰,۰۰۰ امتیاز</div>
                            <button onclick="research('automation')">تحقیق</button>
                        </div>
                    </div>
                    <div class="research-category">
                        <h3>⚔️ فناوری نظامی</h3>
                        <div class="research-item">
                            <h4>🚀 موشک‌های هوشمند</h4>
                            <p>قدرت نظامی +۳۰٪</p>
                            <div class="research-cost">هزینه: ۱۵,۰۰۰ امتیاز</div>
                            <button onclick="research('smart-missiles')">تحقیق</button>
                        </div>
                    </div>
                    <div class="research-category">
                        <h3>🌱 فناوری زیست‌محیطی</h3>
                        <div class="research-item">
                            <h4>☀️ انرژی خورشیدی</h4>
                            <p>تولید انرژی +۲۵٪</p>
                            <div class="research-cost">هزینه: ۸,۰۰۰ امتیاز</div>
                            <button onclick="research('solar-energy')">تحقیق</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- صفحه نقشه جهان -->
        <div id="world-tab" class="tab-content">
            <div class="world-overview">
                <h2>🌍 نقشه جهان</h2>
                <div class="world-map">
                    <div class="region iran" onclick="selectRegion('iran')">
                        <span class="region-name">ایران</span>
                        <span class="region-power">قدرت: ۸۵</span>
                    </div>
                    <div class="region usa" onclick="selectRegion('usa')">
                        <span class="region-name">آمریکا</span>
                        <span class="region-power">قدرت: ۹۵</span>
                    </div>
                    <div class="region russia" onclick="selectRegion('russia')">
                        <span class="region-name">روسیه</span>
                        <span class="region-power">قدرت: ۸۰</span>
                    </div>
                    <div class="region china" onclick="selectRegion('china')">
                        <span class="region-name">چین</span>
                        <span class="region-power">قدرت: ۹۰</span>
                    </div>
                </div>
                <div class="world-events">
                    <h3>📰 اخبار جهان</h3>
                    <div id="world-news">
                        <div class="news-item">
                            <span class="news-date">سال ۲۰۲۷</span>
                            <span class="news-text">تنش‌های اقتصادی در منطقه افزایش یافته است</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- کنترل‌های بازی -->
        <div class="game-controls">
            <button class="next-turn-btn" onclick="nextTurn()">🔄 نوبت بعدی</button>
            <button class="save-game-btn" onclick="saveGame()">💾 ذخیره بازی</button>
            <button class="settings-btn" onclick="openSettings()">⚙️ تنظیمات</button>
        </div>

        <!-- رویدادها و پیام‌ها -->
        <div id="event-modal" class="modal hidden">
            <div class="modal-content">
                <h3 id="event-title">رویداد جدید</h3>
                <p id="event-description">توضیحات رویداد</p>
                <div class="event-choices">
                    <button id="choice-1" onclick="handleEventChoice(1)">گزینه ۱</button>
                    <button id="choice-2" onclick="handleEventChoice(2)">گزینه ۲</button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    
    <!-- PWA Registration -->
    <script>
        // ثبت Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('./sw.js')
                    .then(function(registration) {
                        console.log('Service Worker ثبت شد:', registration.scope);
                        
                        // بررسی آپدیت
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // نمایش پیام آپدیت
                                    showUpdateNotification();
                                }
                            });
                        });
                    })
                    .catch(function(error) {
                        console.log('خطا در ثبت Service Worker:', error);
                    });
            });
        }

        // نمایش پیام نصب PWA
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            showInstallPromotion();
        });

        function showInstallPromotion() {
            // نمایش دکمه نصب
            setTimeout(() => {
                if (deferredPrompt && !window.matchMedia('(display-mode: standalone)').matches) {
                    const installBanner = document.createElement('div');
                    installBanner.className = 'install-banner';
                    installBanner.innerHTML = `
                        <div class="install-content">
                            <span>📱 امپراطوری ایران را روی گوشی خود نصب کنید!</span>
                            <button onclick="installApp()" class="install-btn">نصب</button>
                            <button onclick="dismissInstall()" class="dismiss-btn">×</button>
                        </div>
                    `;
                    document.body.appendChild(installBanner);
                }
            }, 5000);
        }

        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('کاربر اپلیکیشن را نصب کرد');
                    }
                    deferredPrompt = null;
                    dismissInstall();
                });
            }
        }

        function dismissInstall() {
            const banner = document.querySelector('.install-banner');
            if (banner) {
                banner.remove();
            }
        }

        function showUpdateNotification() {
            const updateNotification = document.createElement('div');
            updateNotification.className = 'update-notification';
            updateNotification.innerHTML = `
                <div class="update-content">
                    <span>🚀 نسخه جدید در دسترس است!</span>
                    <button onclick="updateApp()" class="update-btn">بروزرسانی</button>
                    <button onclick="dismissUpdate()" class="dismiss-btn">بعداً</button>
                </div>
            `;
            document.body.appendChild(updateNotification);
        }

        function updateApp() {
            if (navigator.serviceWorker.controller) {
                navigator.serviceWorker.controller.postMessage({type: 'SKIP_WAITING'});
                window.location.reload();
            }
        }

        function dismissUpdate() {
            const notification = document.querySelector('.update-notification');
            if (notification) {
                notification.remove();
            }
        }

        // تشخیص حالت PWA
        window.addEventListener('DOMContentLoaded', () => {
            if (window.matchMedia('(display-mode: standalone)').matches) {
                console.log('در حالت PWA اجرا می‌شود');
                document.body.classList.add('pwa-mode');
            }
        });

        // مدیریت اتصال اینترنت
        window.addEventListener('online', () => {
            showNotification('🌐 اتصال اینترنت برقرار شد', 'success');
        });

        window.addEventListener('offline', () => {
            showNotification('📵 در حالت آفلاین هستید', 'warning');
        });
    </script>

    <!-- Custom CSS for PWA elements -->
    <style>
        .install-banner, .update-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--gradient-primary);
            color: white;
            padding: 15px 25px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            z-index: 3000;
            animation: slideDown 0.5s ease-out;
        }

        .install-content, .update-content {
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 600;
        }

        .install-btn, .update-btn {
            background: white;
            color: var(--primary-color);
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .install-btn:hover, .update-btn:hover {
            transform: scale(1.05);
        }

        .dismiss-btn {
            background: transparent;
            color: white;
            border: 1px solid white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            line-height: 1;
        }

        .pwa-mode .game-controls {
            bottom: 30px;
        }

        @media (max-width: 480px) {
            .install-banner, .update-notification {
                left: 10px;
                right: 10px;
                transform: none;
            }
            
            .install-content, .update-content {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
        }
    </style>
</body>
</html>